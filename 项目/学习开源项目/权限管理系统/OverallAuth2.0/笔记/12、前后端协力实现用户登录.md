---
created: 2024-12-17T21:57:45 (UTC +08:00)
tags: [Vue3,webApi,è¡¨å•,æµç¨‹,æƒé™,ä»0åˆ°1 æ­å»ºOverallAuth2.0 æƒé™ç®¡ç†ç³»ç»Ÿ,OverallAuth2.0 æƒé™ç®¡ç†ç³»ç»Ÿ]
source: https://www.cnblogs.com/cyzf/p/18560576
author: é™ˆé€¸å­é£
---

# ï¼ˆç³»åˆ—åäºŒï¼‰Vue3+.Net8å®ç°ç”¨æˆ·ç™»å½•ï¼ˆè¶…è¯¦ç»†ç™»å½•æ–‡æ¡£ï¼‰ - é™ˆé€¸å­é£ - åšå®¢å›­

> ## Excerpt
> è¯´æ˜ è¯¥æ–‡ç« æ˜¯å±äºOverallAuth2.0ç³»åˆ—æ–‡ç« ï¼Œæ¯å‘¨æ›´æ–°ä¸€ç¯‡è¯¥ç³»åˆ—æ–‡ç« ï¼ˆä»0åˆ°1å®Œæˆç³»ç»Ÿå¼€å‘ï¼‰ã€‚ è¯¥ç³»ç»Ÿæ–‡ç« ï¼Œæˆ‘ä¼šå°½é‡è¯´çš„éå¸¸è¯¦ç»†ï¼Œåšåˆ°ä¸ç®¡æ–°æ‰‹ã€è€æ‰‹éƒ½èƒ½çœ‹æ‡‚ã€‚ è¯´æ˜ï¼šOverallAuth2.0 æ˜¯ä¸€ä¸ªç®€å•ã€æ˜“æ‡‚ã€åŠŸèƒ½å¼ºå¤§çš„æƒé™+å¯è§†åŒ–æµç¨‹ç®¡ç†ç³»ç»Ÿã€‚ å‹æƒ…æé†’ï¼šæœ¬ç¯‡æ–‡ç« æ˜¯å±äºç³»åˆ—æ–‡ç« ï¼Œçœ‹è¯¥

---
**è¯´æ˜  
**

Â  Â  è¯¥æ–‡ç« æ˜¯å±äºOverallAuth2.0ç³»åˆ—æ–‡ç« ï¼Œæ¯å‘¨æ›´æ–°ä¸€ç¯‡è¯¥ç³»åˆ—æ–‡ç« ï¼ˆä»0åˆ°1å®Œæˆç³»ç»Ÿå¼€å‘ï¼‰ã€‚

Â Â Â  è¯¥ç³»ç»Ÿæ–‡ç« ï¼Œæˆ‘ä¼šå°½é‡è¯´çš„éå¸¸è¯¦ç»†ï¼Œåšåˆ°ä¸ç®¡æ–°æ‰‹ã€è€æ‰‹éƒ½èƒ½çœ‹æ‡‚ã€‚

Â Â Â  è¯´æ˜ï¼šOverallAuth2.0 æ˜¯ä¸€ä¸ªç®€å•ã€æ˜“æ‡‚ã€åŠŸèƒ½å¼ºå¤§çš„æƒé™+å¯è§†åŒ–æµç¨‹ç®¡ç†ç³»ç»Ÿã€‚

å‹æƒ…æé†’ï¼šæœ¬ç¯‡æ–‡ç« æ˜¯å±äºç³»åˆ—æ–‡ç« ï¼Œçœ‹è¯¥æ–‡ç« å‰ï¼Œå»ºè®®å…ˆçœ‹ä¹‹å‰æ–‡ç« ï¼Œå¯ä»¥æ›´å¥½ç†è§£é¡¹ç›®ç»“æ„ã€‚

**qqç¾¤ï¼š801913255ï¼Œè¿›ç¾¤æœ‰ä»€ä¹ˆä¸æ‡‚çš„å°½ç®¡é—®ï¼Œç¾¤ä¸»éƒ½ä¼šè€å¿ƒè§£ç­”ã€‚**

**æœ‰å…´è¶£çš„æœ‹å‹ï¼Œè¯·å…³æ³¨æˆ‘å§(\*^â–½^\*)ã€‚**

**![](https://img2024.cnblogs.com/blog/1158526/202408/1158526-20240824140446786-404771438.png)**

**å…³æ³¨æˆ‘ï¼Œå­¦ä¸ä¼šä½ æ¥æ‰“æˆ‘**

**å‰è¨€**

ã€€ã€€éšç€å‰åç«¯æ¡†æ¶ï¼ˆè½®å­ï¼‰çš„é€æ¸æ­å»ºå®Œæˆï¼Œæˆ‘ä»¬çš„OverallAuth2.0é¡¹ç›®ä¹Ÿæ­£å¼è¿ˆå…¥åŠŸèƒ½å¼€å‘é˜¶æ®µã€‚

ã€€ã€€ä»Šå¤©æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åšä¸€ä¸ªå¸¦æœ‰è®¤è¯çš„ç”¨æˆ·ç™»å½•åŠŸèƒ½ã€‚

ã€€ã€€çœ‹è¯¥æ–‡ç« å‰ï¼Œè¯´æ˜ä¸€ç‚¹ã€‚[æœ€å¥½ç»“åˆæˆ‘ä¹‹å‰çš„ç³»åˆ—æ–‡ç« è§‚çœ‹](https://i.cnblogs.com/posts?cateId=2422243)ï¼Œå› ä¸ºä¼šä½¿ç”¨åˆ°ä¹‹å‰ç³»åˆ—æ–‡ç« ä¸­çš„ä»£ç ã€‚å½“ç„¶æœ‰ä¸€å®šåŸºç¡€çš„ç å‹å¯è‡ªåŠ¨å¿½ç•¥ã€‚

**æµç¨‹å›¾**

**![](https://img2024.cnblogs.com/blog/1158526/202411/1158526-20241121142457829-363665951.png)**

ä»æµç¨‹å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œæœ¬æ¬¡ç™»å½•éå¸¸ç®€å•ï¼Œå®ƒæ²¡æœ‰è¿‡å¤šçš„ä¸šåŠ¡é€»è¾‘ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç™»å½•éªŒè¯ï¼ŒæˆåŠŸä¹‹åï¼Œå°±èƒ½è¿›å…¥ç³»ç»Ÿã€‚è‡³äºè¯´ç™»å½•ä¹‹åçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæœ¬ç¯‡æ–‡ç« ä¸ä¼šæ¶‰åŠï¼ˆäº¤ç”±ä¹‹åçš„ç³»åˆ—æ–‡ç« ï¼‰ã€‚

**å®ç°åŠŸèƒ½**

ã€€ã€€1ã€ç”¨æˆ·ç™»å½•

ã€€ã€€2ã€ç™»å½•å¤±æ•ˆå¤„ç†

ã€€ã€€3ã€å¼‚å¸¸ä¿¡æ¯æç¤º

**ç¼–å†™åç«¯æ¥å£**

ã€€ã€€è¿™é‡Œéœ€è¦ç¼–å†™ç”¨æˆ·ç™»å½•æ¥å£ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·æ•°æ®ã€‚

Â  Â  Â  Â å»ºç«‹ä¸€ä¸ªç”¨æˆ·ç™»å½•åçš„è¿”å›æ¨¡å‹ï¼Œç”±äºåœ¨ä¹‹å‰å·²ç»åˆ›å»ºï¼ˆLoginOutPutï¼‰ï¼Œæˆ‘ä»¬åªéœ€åœ¨è¯¥æ¨¡å‹ä¸­æ·»åŠ ä¸€ä¸ªUserIdå³å¯ï¼Œä»£ç å¦‚ä¸‹

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
/// <summary>
/// ç™»å½•è¾“å‡ºæ¨¡å‹
/// </summary>
public class LoginOutPut
{
    /// <summary>
    /// ç”¨æˆ·ID
    /// </summary>
    public int UserId { get; set; }

    /// <summary>
    /// ç”¨æˆ·å
    /// </summary>
    public string? UserName { get; set; }

    /// <summary>
    /// å¯†ç 
    /// </summary>
    public string? Password { get; set; }

    /// <summary>
    /// Token
    /// </summary>
    public string? Token { get; set; }

    /// <summary>
    /// Tokenè¿‡æœŸæ—¶é—´
    /// </summary>
    public string? ExpiresDate { get; set; }

}
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

ISysUserRepositoryä»“å‚¨æ¥å£ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥æ‰¾æ•°æ®çš„æ¥å£

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
/// <summary>
/// æ ¹æ®ç”¨æˆ·åç§°å’Œå¯†ç è·å–ç”¨æˆ·ä¿¡æ¯
/// </summary>
/// <param name="userName">ç”¨æˆ·åç§°</param>
/// <param name="password">ç”¨æˆ·å¯†ç </param>
/// <returns></returns>
public SysUser? GetUserMsg(string userName, string password);
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

SysUserRepositoryä»“å‚¨ä¸­ï¼Œå®ç°æ¥å£

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
/// <summary>
        /// æ ¹æ®ç”¨æˆ·åç§°å’Œå¯†ç è·å–ç”¨æˆ·ä¿¡æ¯
        /// </summary>
        /// <param name="userName">ç”¨æˆ·åç§°</param>
        /// <param name="password">ç”¨æˆ·å¯†ç </param>
        /// <returns></returns>
        public SysUser? GetUserMsg(string userName, string password)
        {
            string sql = " select * from Sys_User where UserName =@UserName and Password=@Password";
            using var connection = DataBaseConnectConfig.GetSqlConnection();
            return connection.QueryFirstOrDefault<SysUser>(sql, new { UserName = userName, Password = password });
        }
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

åŒç†åœ¨SysUserServiceã€ISysUserServiceå±‚ä¸­ï¼Œæ·»åŠ ç›¸åŒæ¥å£

ISysUserService

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
/// <summary>
/// æ ¹æ®ç”¨æˆ·åç§°å’Œå¯†ç è·å–ç”¨æˆ·ä¿¡æ¯
/// </summary>
/// <param name="userName">ç”¨æˆ·åç§°</param>
/// <param name="password">ç”¨æˆ·å¯†ç </param>
/// <returns></returns>
ReceiveStatus<LoginOutPut> GetUserMsg(string userName, string password);
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

SysUserService

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
/// <summary>
 /// æ ¹æ®ç”¨æˆ·åç§°å’Œå¯†ç è·å–ç”¨æˆ·ä¿¡æ¯
 /// </summary>
 /// <param name="userName">ç”¨æˆ·åç§°</param>
 /// <param name="password">ç”¨æˆ·å¯†ç </param>
 /// <returns></returns>
 public ReceiveStatus<LoginOutPut> GetUserMsg(string userName, string password)
 {
     ReceiveStatus<LoginOutPut> receiveStatus = new ReceiveStatus<LoginOutPut>();
     List<LoginOutPut> loginResultsList = new List<LoginOutPut>();
     if (string.IsNullOrEmpty(userName))
         return ExceptionHelper<LoginOutPut>.CustomExceptionData("ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼");
     if (string.IsNullOrEmpty(password))
         return ExceptionHelper<LoginOutPut>.CustomExceptionData("å¯†ç ä¸èƒ½ä¸ºç©ºï¼");
     var result = _sysUserRepository.GetUserMsg(userName, password);
     if (result == null)
         return ExceptionHelper<LoginOutPut>.CustomExceptionData(string.Format("ç”¨æˆ·ã€{0}ã€‘ä¸å­˜åœ¨,æˆ–è´¦å·å¯†ç è¾“å…¥é”™è¯¯", userName));
     if (result.IsOpen == false)
         return ExceptionHelper<LoginOutPut>.CustomExceptionData(string.Format("ç”¨æˆ·ã€{0}ã€‘å·²åœç”¨ï¼Œè¯·å¼€å¯åå†ç™»å½•", userName));
    
     LoginOutPut loginResults = new LoginOutPut()
     {
         UserId = result.UserId,
         UserName = result.UserName,
         Token = string.Empty,
         ExpiresDate = string.Empty
     };
     loginResultsList.Add(loginResults);
     receiveStatus.data = loginResultsList;
     receiveStatus.msg = "ç™»å½•æˆåŠŸ";
     return receiveStatus;
 }
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

ä¸Šè¿°æ¥å£ä¸­ï¼Œæˆ‘ä»¬è¦éªŒè¯ç”¨æˆ·åã€å¯†ç æ˜¯å¦ä¸ºç©ºï¼Œæ˜¯å¦æ­£ç¡®ï¼Œç”¨æˆ·è´¦å·æ˜¯å¦å¯ç”¨ç­‰ã€‚å¦‚æœéªŒè¯ä¸é€šè¿‡ã€‚æˆ‘ä»¬ä½¿ç”¨ExceptionHelperå¼‚å¸¸å¸®åŠ©ç±»ï¼ŒæŠŠå¼‚å¸¸ä¿¡æ¯ï¼Œåé¦ˆç»™å‰ç«¯ã€‚

å¦‚æœéªŒè¯é€šè¿‡ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›ç”¨æˆ·åã€ç”¨æˆ·idã€tokenã€è¿‡æœŸæ—¶é—´ç»™å‰ç«¯ã€‚

åœ¨SysUserControlleræ§åˆ¶å™¨ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹æ¥å£

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
/// <summary>
 /// ç™»å½•
 /// </summary>
 /// <returns></returns>
 [HttpPost]
 [AllowAnonymous] // ä¸éªŒè¯æƒé™
 public ReceiveStatus<LoginOutPut> Login(LoginInput loginModel)
 {
     var result = _userService.GetUserMsg(loginModel.UserName ?? string.Empty, loginModel.Password ?? string.Empty);
     if (result.success)
     {
         var loginResult = result.data.First();
         var tokenResult = JwtPlugIn.BuildToken(loginModel);
         loginResult.Token = tokenResult.Token;
         loginResult.ExpiresDate = tokenResult.ExpiresDate;
         result.data = new List<LoginOutPut>() { loginResult };
     }
     return result;
 }
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

å› ä¸ºæ˜¯ç”¨æˆ·ç™»å½•æ¥å£ï¼Œæ‰€ä»¥ä¸éœ€è¦jwtéªŒè¯

åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œæˆ‘ä»¬æ ¹æ®ç”¨æˆ·åã€ç”¨æˆ·å¯†ç ã€jwté…ç½®ä¿¡æ¯ç”Ÿæˆtokenå’Œè¿‡æœŸæ—¶é—´ã€‚

psï¼š[jwté…ç½®ä¿¡æ¯è¯·æŸ¥çœ‹ä¹‹å‰ç³»åˆ—æ–‡ç« ](https://www.cnblogs.com/cyzf/p/18417965)

**å‰ç«¯ç»“æ„è°ƒæ•´**

ç§»åŠ¨ä¸€ä¸‹æ–‡ä»¶ï¼ˆä¸æ˜¯è·Ÿç€ç³»åˆ—æ–‡ç« çš„ï¼Œè¯·å¿½ç•¥ï¼Œä¸»è¦æ˜¯å‰ç«¯ç»“æ„è°ƒæ•´ï¼‰

æŠŠcomponentsæ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡ï¼Œç§»åŠ¨åˆ°åŒsrcæ–‡ä»¶å¤¹åŒçº§çš„resourcesçš„pictureç›®å½•ä¸‹ï¼ˆè®°ä½è°ƒæ•´å›¾ç‰‡å¼•ç”¨è·¯å¾„ï¼‰ã€‚

æŠŠcomponentsæ–‡ä»¶å¤¹ä¸‹çš„HelloWorld.vueæ–‡ä»¶å†…å®¹ï¼Œæ‹·è´åˆ°viewsä¸‹çš„frameworkæ–‡ä»¶å¤¹ä¸­ï¼ˆæ²¡æœ‰å°±æ–°å»ºï¼‰ï¼Œç„¶ååˆ é™¤componentsæ–‡ä»¶å¤¹ã€‚

**æ­å»ºç™»å½•ç•Œé¢**

åœ¨scræ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmodelæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ä¸‹é¢åˆ›å»ºuseræ–‡ä»¶å¤¹ï¼Œç„¶åå†useræ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªLoginInput.tsçš„æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾å­—æ®µï¼ˆmodelæ–‡ä»¶å¤¹ä»¥åä½œä¸ºå­˜æ”¾æ¨¡å‹çš„æ–‡ä»¶å¤¹ï¼‰

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
export interface LoginInput {
    //ç”¨æˆ·åç§°
    UserName: string;
    //ç”¨æˆ·å¯†ç 
    Password: string;
}
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

æ¥ç€å¾€ä¸‹ã€‚

åœ¨apiæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºuseræ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ index.tsæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆapiæ–‡ä»¶å¤¹ä»¥åä½œä¸ºå­˜æ”¾è°ƒç”¨åç«¯æ¥å£çš„æ–‡ä»¶å¤¹ï¼‰

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
import { LoginInput } from '@/model/user/LoginInput';
import Http from '../http';

export const login = function(loginForm: LoginInput) {
    return Http.post('/api/SysUser/Login', loginForm)
}
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

è¯¥ä»£ç ä¸»è¦æ˜¯è°ƒç”¨åç«¯å†™çš„ç™»å½•æ¥å£

æ¥ç€å¾€ä¸‹ã€‚

åœ¨viewsæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºloginæ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ index.vueæ–‡ä»¶ã€‚å†…å®¹å¦‚ä¸‹

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
<template>
  <div class="backgroundStyle">
    <div class="loginStyle">
      <div style="color: rgb(76 104 139)">
        <div class="systemTitle">
          OverallAuth2.0 æƒé™ç®¡ç†ç³»ç»Ÿ
        </div>
        <div class="systemSubTitle">
          ç®€å•ã€æ˜“æ‡‚ã€åŠŸèƒ½å¼ºå¤§ï¼Œæ¬¢è¿è®¿é—®ä½¿ç”¨ã€‚
        </div>
      </div>
      <div style="height: calc(100% - 260px)">
        <div class="fieldStyle">
          <div style="width: 100%; text-align: left; margin-left: 10%">
            <el-tag>å¯†ç ç™»å½•</el-tag>
          </div>
        </div>
        <div class="fieldStyle">
          <div style="width: 100%">
            <el-input
              v-model="loginForm.UserName"
              style="width: 80%; height: 40px"
              placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
              :prefix-icon="User"
            />
          </div>
        </div>
        <div class="fieldStyle">
          <div style="width: 100%">
            <el-input
              v-model="loginForm.Password"
              style="width: 80%; height: 40px"
              placeholder="è¯·è¾“å…¥å¯†ç "
              type="password"
              show-password
              :prefix-icon="Hide"
            />
          </div>
        </div>
        <div class="fieldStyle">
          <div style="width: 100%">
            <el-input
              v-model="code"
              style="width: 80%; height: 40px"
              placeholder="è¯·è¾“å…¥éªŒè¯ç "
              :prefix-icon="Position"
            />
          </div>
        </div>
        <div class="fieldStyle">
          <div style="width: 100%">
            <el-button
              @click="loginClick"
              type="primary"
              style="width: 80%; height: 50px"
              >ç™»å½•</el-button
            >
          </div>
        </div>
      </div>
      <div style="height: 60px; text-align: left; margin-left: 10px">
        <el-checkbox v-model="isStarted" label="ç äº‘æ˜¯å¦Star" size="large" />
        <div style="color: red; font-size: 12px">
          *ä¸ºäº†å¸®åŠ©æ›´å¤šçš„äººçŸ¥é“åŠäº†è§£æœ¬é¡¹ç›®,è¯·å¸®å¿™Starã€‚æ‹œè°¢å„ä½ğŸ™ğŸ™ğŸ™
        </div>
      </div>
      <div class="loginBottomStyle">
        <el-divider content-position="left"
          ><el-icon color="red"><star-filled /></el-icon>ç‰¹è‰²åŠŸèƒ½</el-divider
        >
        <div class="featuresFunction">
          <el-tag>å¯è§†åŒ–æƒé™è®¾è®¡</el-tag>
          <el-tag type="success">æ•°æ®è¡Œæƒé™</el-tag>
          <el-tag type="warning">æ•°æ®åˆ—æƒé™</el-tag>
          <el-tag type="danger">å®Œæ•´æµç¨‹å®¡æ‰¹</el-tag>
        </div>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { defineComponent, onMounted, reactive, ref } from "vue";
import { TestAutofac } from "../../api/module/user";
import { User, Hide, Position, StarFilled } from "@element-plus/icons-vue";
import { ElMessage } from "element-plus";
import { useRouter } from "vue-router";
import { login } from "@/api/user";
import { LoginInput } from "@/model/user/LoginInput";
import { useUserStore } from "../../store/user";
import { storeToRefs } from "pinia";
export default defineComponent({
  setup() {
    //åˆå§‹åŠ è½½
    onMounted(() => {
      //TestAutofacMsg();
    });
    const userStore = useUserStore();
    
    const router1 = useRouter();
    const userName = ref("");
    const password = ref("");
    const code = ref("");
    const isStarted = ref<boolean>(false);
    //è°ƒç”¨æ¥å£
    const TestAutofacMsg = async () => {
      var result = await TestAutofac();
      console.log(result);
    };

    const loginForm = reactive<LoginInput>({
      UserName: "å¼ ä¸‰",
      Password: "1",
    });
    const loginClick = function () {
      login(loginForm).then(({ data, code, msg }) => {
        setTimeout(() => {
          if (code == 200) {
            userStore.token = data[0].token.toString();
            userStore.expiresDate = data[0].expiresDate;
            userStore.userInfo = {
              userName: data[0].userName,
              userId: data[0].userId,
            };

            ElMessage({
              message: "ç™»å½•æˆåŠŸ",
              type: "success",
            });
            router1.push({ path: "/framework" });
          }
        }, 1000);
      });
    };

    return {
      User,
      Hide,
      Position,
      StarFilled,
      userName,
      password,
      code,
      isStarted,
      loginClick,
      loginForm,
    };
  },
  components: {},
});
</script>

<style scoped>
.backgroundStyle {
  background-image: url(../../../resources/picture/login.png);
  height: calc(100vh);
  width: 100%;
  background-size: 100% 100%;
  display: flex;
}

.loginStyle {
  width: 23%;
  height: 55%;
  margin-top: 12%;
  margin-left: 10%;
  border: 2px solid white;
  background-color: white;
  border-radius: 10px;
  box-shadow: 0px 0px 19px 0px rgba(132, 203, 255, 2.5);
}
.systemTitle {
  height: 70px;
  font-size: 30px;
  justify-content: center;
  align-items: center;
  display: flex;
}
.systemSubTitle {
  display: flex;
  height: 30px;
  font-size: 14px;
  justify-content: center;
  border-bottom: 1px solid #e1dede;
}

.loginBottomStyle {
  height: 100px;
  /* font-size: 30px; */
  justify-content: center;
  align-items: center;
}

.fieldStyle {
  display: flex;
  margin-top: 10px;
}

.featuresFunction {
  display: flex;
}
.featuresFunction > * {
  margin-left: 10px;
}
</style>
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

ä¿®æ”¹base-routes.tsæ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸‹2ä¸ªèœå•ã€‚

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
{
    path: '/framework',
    component: Framework,
    name: "æ¶æ„",

  },
  {
    path: '/login',
    component: Login,
    name: "ç™»å½•é¡µé¢",
  },
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

è°ƒæ•´app.vue

æŠŠtemplateä¸­çš„å†…å®¹æ›¿æ¢æˆ<router-view></router-view>å³å¯ï¼Œè¿™ä¸ªè°ƒæ•´çš„åŸå› æ˜¯å®Œå…¨æ ¹æ®è·¯ç”±æ¥è®¿é—®ç•Œé¢ï¼Œé…åˆè·¯ç”±å®ˆå«ï¼Œåšåˆ°æœªç™»å½•æ—¶å°±è¿›å…¥ç™»å½•ç•Œé¢çš„æ•ˆæœã€‚

**çŠ¶æ€åº“æŒä¹…åŒ–**

è¿™ä¸ªæ˜¯æœ¬ç¯‡æ–‡ç« çš„é‡ç‚¹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥æŒä¹…åŒ–è®°å½•ç™»å½•äººå‘˜ç™»å½•ä¿¡æ¯ã€‚ä¸ºä»¥åéªŒè¯tokenè¿‡æœŸã€è·å–ç™»å½•ä¿¡æ¯åšå‡†å¤‡ã€‚

å®‰è£…npm install pinia-plugin-persistæ’ä»¶ã€‚

å¹¶åœ¨main.tsä¸­æ·»åŠ å¼•ç”¨

```
import  persist  from 'pinia-plugin-persist'
pinia.use(persist)
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼špinia.use(persist)ä¸€å®šè¦åœ¨app.use(pinia)å‰é¢ã€‚

åœ¨scrä¸‹å»ºç«‹storeæ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ ä¸‰ä¸ªæ–‡ä»¶app.tsã€index.tsã€user.tsï¼Œå†…å®¹å¦‚ä¸‹

app.ts

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
import { defineStore } from 'pinia'

export const useAppStore = defineStore({
  id: 'app',
  state: () => {
    return {
      tab: true,
      logo: true,
      level: true,
      inverted: false,
      routerAlive: true,
      collapse: false,
      subfield: false,
      locale: "zh_CN",
      subfieldPosition: "side",
      theme: 'light',
      breadcrumb: true,
      sideWidth: "220px",
      sideTheme: 'dark',
      greyMode: false,
      accordion: true,
      tagsTheme: 'concise',
      keepAliveList: [],
      themeVariable: {
        "--global-checked-color": "#5fb878",
        "--global-primary-color": "#009688",
        "--global-normal-color": "#1e9fff",
        "--global-danger-color": "#ff5722",
        "--global-warm-color": "#ffb800",
      },
    }
  },
  persist: {
    enabled: true,
    strategies: [
      {
        // å¯ä»¥æ˜¯localStorageæˆ–sessionStorage
        storage: localStorage,
        // æŒ‡å®šéœ€è¦æŒä¹…åŒ–çš„å±æ€§
        paths: ['token', 'expiresDate', 'userInfo']
      }
    ]
  },
})
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

index.ts

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const store = createPinia();
store.use(piniaPluginPersistedstate);

export default store;
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

user.ts

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
import { defineStore } from 'pinia'
export const useUserStore = defineStore(
  'user', {
  state: () => ({
    token: '',
    expiresDate: '',
    userInfo: {},
  }),

  actions: {},
  //persist:true
  persist: {
    enabled: true,
    strategies: [
      {
        // å¯ä»¥æ˜¯localStorageæˆ–sessionStorage
        storage: localStorage,
        // æŒ‡å®šéœ€è¦æŒä¹…åŒ–çš„å±æ€§
        paths: ['token','expiresDate','userInfo']
      }
    ]
  },
})
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œåœ¨pathså±æ€§ä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©æŒä¹…åŒ–å­˜å‚¨æ•°æ®çš„å­—æ®µã€‚æˆ‘è¿™é‡Œé€‰æ‹©å­˜å‚¨äº†tokenï¼Œè¿‡æœŸæ—¶é—´ã€ç”¨æˆ·ä¿¡æ¯ï¼Œæœ‹å‹ä»¬å¯ä»¥è‡ªè¡Œå†³å®šã€‚

**è·¯ç”±å®ˆå«è°ƒæ•´**

ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è®²è¿‡ï¼Œè·¯ç”±å®ˆå«çš„ä½œç”¨ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚

è°ƒæ•´å¦‚ä¸‹

router.beforeEachæ–¹æ³•å†…å®¹å˜æ›´æˆä¸€ä¸‹ä»£ç 

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

```
NProgress.start();
  const userStore = useUserStore();
  const endTime = new Date(userStore.expiresDate);
  const currentTime = new Date();
  to.path = to.path;
  if (to.meta.requireAuth && endTime < currentTime) {
    router.push('/login')
  }
  if (to.meta.requireAuth) {
    next();
  } else if (to.matched.length == 0) {
    next({ path: '/login' })
  } else {
    next();
  }
```

![å¤åˆ¶ä»£ç ](https://assets.cnblogs.com/images/copycode.gif)

ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºæˆ‘ä»¬åŒè¿‡useUserStoreè·å–äº†ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚ç„¶åæ‹¿åˆ°è¿‡æœŸæ—¶é—´åˆ¤æ–­ç™»å½•æ˜¯å¦è¿‡æœŸã€‚è¿‡æœŸå°±éœ€è¦é‡æ–°ç™»å½•ã€‚

**æç¤ºä¿¡æ¯è°ƒæ•´**

æ‰¾åˆ°åœ¨apiæ–‡ä»¶å¤¹ä¸‹çš„http.tsæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹

**![](https://img2024.cnblogs.com/blog/1158526/202411/1158526-20241125115455701-345135525.png)**

ç»“åˆåç«¯è¿”å›codeï¼Œåšå‡ºå‡†ç¡®æç¤ºã€‚

**æ¼”ç¤ºåœ°å€**

[ç™»å½•æ¼”ç¤º](https://mp.weixin.qq.com/s?__biz=MzkyNDc0Nzk4OA==&mid=2247483888&idx=1&sn=59326f9c859559d64758784b1394126e&chksm=c1d0504bf6a7d95df9b409e6272bd32ab0012fcf5f4fd0dbd7298f84dc84fca3fc72f68ae7b3&token=423466247&lang=zh_CN#rd)

**ç»“è¯­**

æˆ‘ä»¬çš„OverallAuth2.0é¡¹ç›®ä¹Ÿæ­£å¼è¿ˆå…¥åŠŸèƒ½å¼€å‘é˜¶æ®µï¼Œå¯èƒ½æ–‡ç« å†…å®¹é€æ¸å¼€å§‹å¤æ‚åŒ–ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œä¹Ÿæœ‰è·Ÿç€åšä¸»ä»0åˆ°1æ­å»ºæƒé™ç®¡ç†ç³»ç»Ÿçš„å…´è¶£ã€‚

é‚£ä¹ˆè¯·åŠ qqç¾¤ï¼š801913255ï¼Œè¿›ç¾¤æœ‰ä»€ä¹ˆä¸æ‡‚çš„å°½ç®¡é—®ï¼Œç¾¤ä¸»éƒ½ä¼šè€å¿ƒè§£ç­”ã€‚

****åç«¯WebApi**Â é¢„è§ˆåœ°å€ï¼šhttp://139.155.137.144:8880/swagger/index.html**

**å‰ç«¯vue é¢„è§ˆåœ°å€ï¼šhttp://139.155.137.144:8881**

**å…³æ³¨å…¬ä¼—å·ï¼šå‘é€ã€æƒé™ã€‘ï¼Œè·å–å‰åç«¯ä»£ç **

**æœ‰å…´è¶£çš„æœ‹å‹ï¼Œè¯·å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·å§(\*^â–½^\*)ã€‚**

**![](https://img2024.cnblogs.com/blog/1158526/202408/1158526-20240824140446786-404771438.png)**

å…³æ³¨æˆ‘ï¼šä¸€ä¸ªå…¨æ ˆå¤šç«¯çš„å®è—åšä¸»ï¼Œå®šæ—¶åˆ†äº«æŠ€æœ¯æ–‡ç« ï¼Œä¸å®šæ—¶åˆ†äº«å¼€æºé¡¹ç›®ã€‚å…³æ³¨æˆ‘ï¼Œå¸¦ä½ è®¤è¯†ä¸ä¸€æ ·çš„ç¨‹åºä¸–ç•Œ
